version: '2'

services:
    # API: Nginx
    web:
        image: nginx:stable-alpine
        volumes:
            - ./:/var/www/composer-resolver
            - ./docker/nginx.conf:/etc/nginx/conf.d/default.conf
        ports:
            - '56789:80'

    # API: PHP 7.* with FPM SAPI on Alpine Linux Container
    php-fpm:
        image: php:7-fpm-alpine
        volumes:
            - ./:/var/www/composer-resolver

    # API & Worker communication: Redis
    redis:
        image: redis:3.0-alpine

    # Worker: PHP 7.* with CLI SAPI
    worker:
        image: php:7-cli
        volumes:
            - ./:/var/www/composer-resolver
        command: php /var/www/composer-resolver/bin/worker.php
